# Migration `20201129182411`

This migration has been generated by George Munyoro at 11/29/2020, 8:24:11 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "Commment" ADD COLUMN     "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
ADD COLUMN     "updatedAt" TIMESTAMP(3) NOT NULL,
ADD COLUMN     "projectId" TEXT NOT NULL,
ADD COLUMN     "issueId" TEXT NOT NULL

ALTER TABLE "Issue" ADD COLUMN     "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
ADD COLUMN     "updatedAt" TIMESTAMP(3) NOT NULL,
ADD COLUMN     "projectId" TEXT NOT NULL,
ADD COLUMN     "boardId" TEXT NOT NULL,
ADD COLUMN     "columnId" TEXT NOT NULL

ALTER TABLE "User" DROP COLUMN "name",
ADD COLUMN     "firstname" TEXT,
ADD COLUMN     "lastname" TEXT NOT NULL,
ADD COLUMN     "password" TEXT NOT NULL,
ADD COLUMN     "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP

CREATE TABLE "Project" (
    "id" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,
    "userId" TEXT NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Board" (
    "id" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,
    "projectId" TEXT NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Column" (
    "id" TEXT NOT NULL,
    "position" INTEGER NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,
    "projectId" TEXT NOT NULL,
    "boardId" TEXT NOT NULL,

    PRIMARY KEY ("id")
)

ALTER TABLE "Project" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Board" ADD FOREIGN KEY("projectId")REFERENCES "Project"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Column" ADD FOREIGN KEY("projectId")REFERENCES "Project"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Column" ADD FOREIGN KEY("boardId")REFERENCES "Board"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Commment" ADD FOREIGN KEY("projectId")REFERENCES "Project"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Commment" ADD FOREIGN KEY("issueId")REFERENCES "Issue"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Issue" ADD FOREIGN KEY("projectId")REFERENCES "Project"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Issue" ADD FOREIGN KEY("boardId")REFERENCES "Board"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Issue" ADD FOREIGN KEY("columnId")REFERENCES "Column"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201129125941..20201129182411
--- datamodel.dml
+++ datamodel.dml
@@ -2,30 +2,64 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
 }
 model User {
-  id    String    @id @default(uuid())
-  email String    @unique
-  name  String?
+  id              String    @id @default(uuid())
+  email           String    @unique
+  firstname       String?
+  lastname        String
+  password        String
+  createdAt       DateTime  @default(now())
 }
+model Project {
+  id              String    @id @default(uuid())
+  owner           User
+  createdAt       DateTime  @default(now())
+  updatedAt       DateTime  @updatedAt
+}
+
+model Board {
+  id              String    @id @default(uuid())
+  project         Project
+  createdAt       DateTime  @default(now())
+  updatedAt       DateTime  @updatedAt
+}
+
+model Column {
+  id              String    @id @default(uuid())
+  position        Int
+  project         Project
+  board           Board
+  createdAt       DateTime  @default(now())
+  updatedAt       DateTime  @updatedAt
+}
+
 model Issue {
-  id          String  @id @default(uuid())
-  author      User
-  title       String
-  description String
+  id              String    @id @default(uuid())
+  author          User
+  title           String
+  description     String
+  project         Project
+  board           Board
+  column          Column
+  createdAt       DateTime  @default(now())
+  updatedAt       DateTime  @updatedAt
 }
 model Commment {
-  id        String  @id @default(uuid())
-  author    User
-  contents  String
+  id              String    @id @default(uuid())
+  author          User
+  contents        String
+  project         Project
+  issue           Issue
+  createdAt       DateTime  @default(now())
+  updatedAt       DateTime  @updatedAt
 }
-
```


