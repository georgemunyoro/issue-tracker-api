# Migration `20201206144003-init`

This migration has been generated by George Munyoro at 12/6/2020, 4:40:03 PM.
You can check out the [state of the schema](./schema.prisma) after the
migration.

## Database Steps

```sql
CREATE TYPE "public"."Urgency" AS ENUM ('MINOR', 'NORMAL', 'MAJOR', 'CRITICAL', 'SHOW_STOPPER')

CREATE TABLE "User" (
    "id" TEXT NOT NULL,
    "email" TEXT NOT NULL,
    "firstname" TEXT NOT NULL,
    "lastname" TEXT NOT NULL,
    "username" TEXT NOT NULL,
    "password" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,

    PRIMARY KEY ("id")
)

CREATE TABLE "Project" (
    "id" TEXT NOT NULL,
    "name" TEXT NOT NULL,
    "ownerId" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Board" (
    "id" TEXT NOT NULL,
    "name" TEXT NOT NULL,
    "description" TEXT NOT NULL,
    "projectId" TEXT NOT NULL,
    "columnLayout" JSONB,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Column" (
    "id" TEXT NOT NULL,
    "name" TEXT NOT NULL,
    "boardId" TEXT NOT NULL,
    "projectId" TEXT,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Issue" (
    "id" TEXT NOT NULL,
    "authorId" TEXT NOT NULL,
    "title" TEXT NOT NULL,
    "description" TEXT NOT NULL,
    "urgency" "Urgency" NOT NULL DEFAULT E'NORMAL',
    "projectId" TEXT,
    "boardId" TEXT,
    "columnId" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Comment" (
    "id" TEXT NOT NULL,
    "authorId" TEXT NOT NULL,
    "contents" TEXT NOT NULL,
    "projectId" TEXT,
    "issueId" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "User.email_unique" ON "User"("email")

CREATE UNIQUE INDEX "Project.name_ownerId_unique" ON "Project"("name", "ownerId")

CREATE UNIQUE INDEX "Board.name_projectId_unique" ON "Board"("name", "projectId")

CREATE UNIQUE INDEX "Column.name_boardId_unique" ON "Column"("name", "boardId")

ALTER TABLE "Project" ADD FOREIGN KEY("ownerId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Board" ADD FOREIGN KEY("projectId")REFERENCES "Project"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Column" ADD FOREIGN KEY("boardId")REFERENCES "Board"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Column" ADD FOREIGN KEY("projectId")REFERENCES "Project"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "Issue" ADD FOREIGN KEY("authorId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Issue" ADD FOREIGN KEY("projectId")REFERENCES "Project"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "Issue" ADD FOREIGN KEY("boardId")REFERENCES "Board"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "Issue" ADD FOREIGN KEY("columnId")REFERENCES "Column"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Comment" ADD FOREIGN KEY("authorId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Comment" ADD FOREIGN KEY("projectId")REFERENCES "Project"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "Comment" ADD FOREIGN KEY("issueId")REFERENCES "Issue"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201206144003-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,107 @@
+// This is your Prisma schema file,
+// learn more about it in the docs: https://pris.ly/d/prisma-schema
+
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+enum Urgency {
+  MINOR
+  NORMAL
+  MAJOR
+  CRITICAL
+  SHOW_STOPPER
+}
+
+model User {
+  id        String    @id @default(uuid())
+  email     String    @unique
+  firstname String
+  lastname  String
+  username  String
+  password  String
+  createdAt DateTime  @default(now())
+  projects  Project[]
+  issues    Issue[]
+  comments  Comment[]
+}
+
+model Project {
+  id        String    @id @default(uuid())
+  name      String
+  owner     User      @relation(fields: [ownerId], references: [id])
+  ownerId   String
+  createdAt DateTime  @default(now())
+  updatedAt DateTime  @updatedAt
+  boards    Board[]
+  columns   Column[]
+  issues    Issue[]
+  comments  Comment[]
+
+  @@unique([name, ownerId])
+}
+
+model Board {
+  id           String   @id @default(uuid())
+  name         String
+  description  String
+  project      Project  @relation(fields: [projectId], references: [id])
+  projectId    String
+  columnLayout Json?
+  createdAt    DateTime @default(now())
+  updatedAt    DateTime @updatedAt
+  columns      Column[]
+  issues       Issue[]
+
+  @@unique([name, projectId])
+}
+
+model Column {
+  id        String   @id @default(uuid())
+  name      String
+  board     Board    @relation(fields: [boardId], references: [id])
+  boardId   String
+  project 	Project? @relation(fields: [projectId], references: [id])
+  projectId String?
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  issues    Issue[]
+
+  @@unique([name, boardId])
+}
+
+model Issue {
+  id          String    @id @default(uuid())
+  author      User      @relation(fields: [authorId], references: [id])
+  authorId    String
+  title       String
+  description String
+  urgency     Urgency   @default(NORMAL)
+  project     Project?   @relation(fields: [projectId], references: [id])
+  projectId   String?
+  board       Board?     @relation(fields: [boardId], references: [id])
+  boardId     String?
+  column      Column    @relation(fields: [columnId], references: [id])
+  columnId    String
+  createdAt   DateTime  @default(now())
+  updatedAt   DateTime  @updatedAt
+  comments    Comment[]
+}
+
+model Comment {
+  id        String   @id @default(uuid())
+  author    User     @relation(fields: [authorId], references: [id])
+  authorId  String
+  contents  String
+  project   Project?  @relation(fields: [projectId], references: [id])
+  projectId String?
+  issue     Issue    @relation(fields: [issueId], references: [id])
+  issueId   String
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
```
